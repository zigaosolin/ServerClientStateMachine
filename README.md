An attempt to encapsulate Server<->Client State Machine